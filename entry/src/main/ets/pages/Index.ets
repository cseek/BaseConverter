@Entry
@Component
struct Index {
  @State inputValue: string = '';
  @State fromBase: number = 10;
  @State toBase: number = 2;
  @State result: string = '';
  @State errorMessage: string = '';

  private baseOptions: string[] = ['äºŒè¿›åˆ¶ (2)', 'å…«è¿›åˆ¶ (8)', 'åè¿›åˆ¶ (10)', 'åå…­è¿›åˆ¶ (16)'];
  private baseValues: number[] = [2, 8, 10, 16];

  build() {
    Column() {
      // ä¸Šéƒ¨å†…å®¹åŒºåŸŸï¼ˆå å±å¹•3/4ï¼‰
      Column({ space: 10 }) {
        Text('è¿›åˆ¶è½¬æ¢å™¨')
          .fontSize(40)
          .margin({ bottom: 10, top: 30 })
        // è¾“å…¥æ¡†
        TextInput({ placeholder: 'è¯·è¾“å…¥æ•°å€¼ï¼ˆå¦‚255ï¼‰' })
          .width('90%')
          .height(50)
          .fontSize(18)
          .margin({ bottom: 40, top: 40})
          .backgroundColor(Color.White)
          .borderRadius(8)
          .onChange((value: string) => {
            this.inputValue = value;
            this.errorMessage = '';
          })

        // è¿›åˆ¶é€‰æ‹©å™¨è¡Œ
        Row() {
          Column() {
            Text('åŸè¿›åˆ¶:')
              .fontSize(16)
              .margin({ bottom: 40 })

            TextPicker({ range: this.baseOptions })
              .width('100%')
              .selectedIndex(this.baseValues.indexOf(this.fromBase))
              .onChange((value: string | string[], index: number | number[]) => {
                const selectedIndex = Array.isArray(index) ? index[0] : index;
                this.fromBase = this.baseValues[selectedIndex];
              })
          }
          .width('45%')
          .margin({ right: '5%' })

          Column() {
            Text('ç›®æ ‡è¿›åˆ¶:')
              .fontSize(16)
              .margin({ bottom: 40 })

            TextPicker({ range: this.baseOptions })
              .width('100%')
              .selectedIndex(this.baseValues.indexOf(this.toBase))
              .onChange((value: string | string[], index: number | number[]) => {
                const selectedIndex = Array.isArray(index) ? index[0] : index;
                this.toBase = this.baseValues[selectedIndex];
              })
          }
          .width('45%')
        }
        .width('90%')
        .height(200)
      }
      .width('100%')
      .height('65%') // å æ®å±å¹•3/4é«˜åº¦
      .justifyContent(FlexAlign.Start)

      // ä¸‹éƒ¨æ“ä½œåŒºåŸŸï¼ˆå å±å¹•1/4ï¼‰
      Column() {
        Button('è½¬æ¢')
          .width('70%')
          .height(50)
          .fontSize(20)
          .backgroundColor('#007AFF')
          .fontColor(Color.White)
          .margin({ bottom: 10, top: 15 })
          .onClick(() => this.convert())

        Text(this.result)
          .fontSize(24)
          .fontColor(Color.Blue)
          .margin({ bottom: 5 })

        Text(this.errorMessage)
          .fontSize(16)
          .fontColor(Color.Red)
      }
      .width('100%')
      .height('25%') // ç²¾ç¡®æ§åˆ¶ä¸ºå±å¹•1/4é«˜åº¦
      .justifyContent(FlexAlign.Center)

      Text('ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_ï¼¿_')
        .height('3%')
        .fontSize(10)
        .margin({ bottom: 0, top: 30 })

      Text('ğŸ», https://github.com/cseek/BaseConverter')
        .height('7%')
        .fontSize(13)
        .margin({ bottom: 3, top: 0})

    }
    .width('100%')
    .height('100%')
    .padding(20)
    .backgroundColor('#F5F5F5')
  }

  convert() {
    if (!this.inputValue) {
      this.errorMessage = 'è¯·è¾“å…¥æ•°å€¼';
      return;
    }

    try {
      const decimalValue = parseInt(this.inputValue, this.fromBase);
      if (isNaN(decimalValue)) throw new Error();
      this.result = decimalValue.toString(this.toBase).toUpperCase();
      this.errorMessage = '';
    } catch {
      this.errorMessage = 'è¾“å…¥å€¼ä¸åˆæ³•';
      this.result = '';
    }
  }
}